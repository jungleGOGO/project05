<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tsherpa.team35.per.ReportMapper">

    <resultMap id="Report" type="com.tsherpa.team35.entity.Report">
        <result property="reportId" column="report_id" />
        <result property="marketNo" column="market_no" />
        <result property="reqNO" column="req_no" />
        <result property="title" column="title" />
        <result property="loginId" column="login_id" />
        <result property="reporter" column="reporter" />
        <result property="reason" column="reason" />
        <result property="reportDate" column="report_date" />
    </resultMap>

    <insert id="reportMarInsert">
        insert into report (marketNo, loginId, title, reporter, reason) values (#{marketNo}, #{loginId}, #{title}, #{reporter}, #{reason})
    </insert>

    <insert id="reportReqInsert">
        insert into report (reqNo, loginId, title, reporter, reason) values (#{reqNo}, #{loginId}, #{title} , #{reporter}, #{reason})
    </insert>

    <select id="reportMarketList" resultType="com.tsherpa.team35.entity.Report">
        select a.report_id, b.title, b.market_no, b.login_id , a.report_date, sub.report_count
        FROM (SELECT market_no, COUNT(market_no) as report_count FROM report GROUP BY market_no) as sub JOIN report a ON(sub.market_no=a.market_no) JOIN market b ON (a.market_no=b.market_no) order BY a.report_date DESC;
    </select>

    <select id="reportReqList" resultType="com.tsherpa.team35.entity.Report">
        SELECT a.report_id, b.title, b.req_no, b.login_id , a.report_date, sub.report_count
        FROM (SELECT req_no, COUNT(req_no) AS report_count FROM report GROUP BY req_no) AS sub JOIN report a ON(sub.req_no=a.req_no) JOIN request b ON (a.req_no=b.req_no) ORDER BY a.report_date DESC;
    </select>

    <select id="reportTotalMar">
        select COUNT(*) from report where market_no
    </select>

    <select id="reportTotalReq">
        select COUNT(*) from report where req_no
    </select>

    <select id="reportCountMar">
        select count(*) from report where market_no=#{marketNo}
    </select>

    <select id="reportCountReq">
        select count(*) from report where req_no=#{reqNo}
    </select>

</mapper>